{% extends "sitebase.html" %}

{% block metatags %}
<meta name="description" content="The Close Call Database helps cyclist to identify dangerous drivers in their area and to share that information with other cyclists and local authorities. The goal of the site is to find drivers that are harassing cyclists on purpose and change their behavior before they harm or kill someone. Have you had a close call with a motorist that you feel was intentional? Report it here.">
<meta name="keywords" content="cycling, cyclist, database, accidents, incidents, aggressive, drivers">
{% endblock %}

{% block page_title %}Close Call Database For Cycling{% endblock %}

{% block extra_styles %}

  {% include 'home-styles.html' %}

{% endblock %}


{% block content %}



{# <p class="alert alert-success text-center" role="alert" style="padding: 10px 20px; 10px; 20px; "><b><i>Merry Christmas to you and yours!</i></b> </p> #}


{% if user.is_authenticated %}
{# <p>Welcome back {{ user.username }}</p> #}
{# holder is referenced in the jquery at bottom of file #}

{% comment %}
If I want to use this I need to http://stackoverflow.com/questions/14939994/jquery-cookies-set-expire-time
then I need to check for it like so:

$(function () {
  if ($.cookie("loaded") != "true") {
      $('body.home').hide().fadeIn('slow');
      $.cookie("loaded", "true");
  }
});
{% endcomment %}
{# just comment it out for now #}
{# <div id="holder"></div> #}

{#  ANNOUNCEMENTS IF ANY #}

{% if announcement %}
  {% for a in announcement %}
    <p class="bg-info" style="padding: 10px 20px; 10px; 20px; color:darkred;">{{a.the_announcement|safe}}</p>
  {% endfor %}
  <hr>
{% endif %}

{# INCIDENTS THAT HAVE OCCURRED IN THE USERS AREA  #}

<ul class="nav nav-tabs nav-justified">
  <li role="presentation" class="active"><a href="{% url 'home' %}">Home</a></li>
  <li role="presentation"><a href="{% url 'show-all-incidents' %}">All Incident Reports</a></li>
  <li role="presentation"><a href="{% url 'home-user-map' %}">User Map</a></li>
</ul>


{% if local_incidents %}

<div style="padding-top:16px;">

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="hpptitle">Incidents Reported In Your Area</h3>
    </div>
    <div class="panel-body" style="font-size:1.2em; line-height:1.55;">

  {% for incident in local_incidents %}
   <div class="incident-block">
    {# <!-- date --> #}
    <p><span class="pad-right" style="font-size: 0.9em;"><b>{{incident.date|date:"M d, Y" }}</b></span>
    {# <!-- time, add later --> #}
    {# <!-- where --> #}
    {% if incident.address %}<span style="font-size: 0.8em; font-weight:bold;">{{incident.address}}</span>{% endif %}
    </p>
    {# <!-- quick driver summary --> #}
    <div class="driver-summary">
        <span class="sm-pad-rt">Driver categorized as: </span><span class="level-{{incident.danger_assessment}}">{{incident.threat_assessment}}</span>, their actions were <span class="level-{{incident.danger_assessment}}">{{incident.danger_level}}</span>.
        {% if incident.vehicle_description %}
          They were driving a <b>{{incident.vehicle_description}}</b>.
          {% if incident.license_certain %} License plate: <b>{{incident.license_certain}}</b> {% endif %}
          {% if incident.license_uncertain%} License plate may be: <b>{{incident.license_uncertain}}</b>{% endif %}
        {% endif %}

      <div class="incident-summary">{{incident.what|safe|truncatewords:50}} <a href="/incident/show-detail/{{incident.id}}/">read more</a></div>
      <hr style="border-top: dotted 1px;" />
    </div>
   </div>
  {% endfor %}
    </div>
  </div>
</div>


{% else %}  {# if else for local incidents #}



<div style="padding-top:16px;">

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="hpptitle">Excellent News: No Incidents have been reported in your area!</h3>
    </div>
    <div class="panel-body" style="font-size:1.2em; line-height:1.55;">
      You are successfully registered. Any future Incident Reports that are filed in your area will be available to you right here. To get a better idea of how the system works, you can view an Incident from a different location right <a href="/incident/show/CO-141108-001/">here</a> or you can <a href="{% url 'show-all-incidents' %}">view them all</a>.</p>
    </div>
  </div>
</div>


{% endif %}
{# end of if local_incidents #}




{% else %} {# else not logged in! #}

{% if announcement %}
  {% for a in announcement %}
    <p class="bg-info" style="padding: 10px 20px; 10px; 20px; color:darkred;">{{a.the_announcement|safe}}</p>
  {% endfor %}
{% endif %}

<div class="jumbotron" style="margin-top: 10px; padding-top: 10px; margin-bottom: 10px; padding-bottom: 40px;">
<h2>Welcome to the Close Call Database</h2>
<hr>
<h3 style="padding-top: 12px;">A Community Project for Safer Cycling</h3>
  <div class="page-header" style="margin: 26px 0 20px;">

    <h2><small>
    Drivers that are hostile to cyclists are often serial offenders. Cataloging their aggression and documenting their hostility towards cyclists provides important information to fellow cyclists, local police and prosecutors. When you record an incident here, it will be shared with cyclists in your area. When other cyclists report an Incident, it will be shared with you.

    When problem drivers are identified this site will contact police where the Incidents have occurred so that they can intervene before another tragedy occurs. If that same driver does harm a cyclist at a later date, the information in the Incident Reports will increase the likelihood that justice is served.
    </h2></small>

    <h2><small>
    If you would like to be notified of aggressive drivers in your area, or if you would like to report an incident with a hostile driver simply <a href="/get-strava-login"><img src="/static/images/LogInWithStrava.png"></a> or <a href="/accounts/register/" style="text-decoration: none;">register</a> to create an account. [If you are already registered and are returning to review incident reports, access the login screen from the menu at the top of the page]
    </h2></small>

    <h2><small>
    No one is going to solve this problem for us. We have to do it ourselves. Please choose to be part of the solution.
    </h2></small>

    <h2><small>
    In case you need more, I wrote a <a href="/articles/the-rationale-behind-the-close-call-database/">post</a> explaining my rationale and motivation. Still don't get it? Read this story at <a href="http://www.cnn.com/2015/05/13/living/feat-bike-helmet-cameras/" target="_blank">CNN</a>.
    </h2></small>

    <h2><small>
    <i>Note, this site augments but does not replace current practices. If you have had a threatening encounter with a motorist you should still report it to the police!</i>
    </h2></small>


  </div>
</div>


{% include 'user-map.html' %}

{% endif %}

{# {% if user.is_authenticated %}<p>Welcome back {{ user.username }}{%else%}</p> #}



{% endblock %}

{% block extra_scripts %}
 {% if user.is_authenticated %}
  <script type="text/javascript">

    $(function() {
        $('<div><p>Welcome back {{ user.username }}</p></div>')
        .insertAfter('#holder')
        .delay(3000)
        .fadeOut(function() {
          $(this).remove();
        });
    });


  </script>
 {% endif %}
{% endblock %}